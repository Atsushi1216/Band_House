
<h1>曲一覧ページ</h1>

<div>
  <h3>いいね数ランキング</h3>
<% @all_ranks.each.with_index(1) do |music, i| %>
 第<%= i %>位
 <%= link_to music.title,  music_path(music.id) %>
 <%= music.favorites.count %>いいね<br>
 <br>
 <% end %>
</div>

<hr>

<% @musics.each do |music| %>
<%# binding.pry %>
<div class="container mt-5">
  <div class="row">
    <div class="col-9 mx-auto">
      <div class="card"style="width: 50rem;">
        <div class="card-body">
          <p class="card-text">名前</p>
            <p class="card-text"><%= link_to music.user.name, user_path(music.user_id) %>
              <%= attachment_image_tag music.user, :profile_image, :fill, 40, 40, fallback: "no_image.jpg" %></p>
            <p class="card-text">曲名</p>
            <p class="card-text"><small><%= link_to music.title,  music_path(music.id) %></small></p>
            <p class="card-text">ジャケ写</p>
            <p class="card-text"><small><%= link_to music_path(music.id) do %>
              <%= attachment_image_tag(music, :song_image, :fill, 30, 30, fallback: "no_image.jpg") %>
              <% end %></small></p>
            <p class="card-text">曲について</p>
            <p class="card-text"><small><%= music.caption %></small></p>
            <p class="card-text">音源</p>
            <p class="card-text"><small><audio src= "<%= "#{music.song}" %>" controls=""></audio></small></p>
            <p class="card-text">曲に対する評価</p>
            <p class="music-evaluation" data-score="<%= music.evaluation %>"><small></small></p>
            <p class="card-text">コメント件数</p>
             <p class="card-text"><%= link_to music.comments.count, music_path(music.id) %></p>
        </div>
      </div>
    </div>
  </div>
</div>
    <div><% if music.user == current_user %>
      <%= link_to "削除", music_path(music), method: :delete %>
      <% end %>
    </div>
  <% end %>
  </tbody>
</table>
  <script>
      $('.music-evaluation').raty({
        readOnly: true,
        score: function() {
        return $(this).attr('data-score');
      },
        path: '/assets/'
      });
  </script>

<%= paginate @musics %>
